{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useUser}from'@clerk/clerk-react';import{getEmailError,getPhoneError}from'../../utils/validation';import apiService from'../../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MAX_GROUP_SIZE=7;const MIN_GROUP_SIZE=2;function getInitialGroup(){return Array(MIN_GROUP_SIZE).fill({firstName:'',lastName:'',email:''});}export default function RegistrationModal(_ref){var _user$primaryEmailAdd5;let{isOpen,onClose,onRegistrationComplete}=_ref;const{user}=useUser();const[type,setType]=useState('solo');const[leagues,setLeagues]=useState([]);const[selectedLeague,setSelectedLeague]=useState(null);const[userProfile,setUserProfile]=useState(null);const[isLoading,setIsLoading]=useState(false);const[solo,setSolo]=useState({firstName:'',lastName:'',email:'',phone:'',dateOfBirth:'',gender:'',termsAccepted:false,communicationsAccepted:false});const[groupName,setGroupName]=useState('');const[group,setGroup]=useState(getInitialGroup());const[error,setError]=useState('');const[success,setSuccess]=useState('');// Update fieldErrors type\nconst[fieldErrors,setFieldErrors]=useState({});// Load leagues and user profile when modal opens\nuseEffect(()=>{if(isOpen&&user){const loadData=async()=>{setIsLoading(true);try{// Load active leagues\nconst leaguesData=await apiService.getActiveLeagues();setLeagues(leaguesData);if(leaguesData.length>0){setSelectedLeague(leaguesData[0].id);// Select first league by default\n}// Load user profile\nconst profile=await apiService.getUserProfile(user.id);setUserProfile(profile);// Pre-fill solo registration with user profile data\nif(profile&&type==='solo'){setSolo(prev=>{var _user$primaryEmailAdd;return{...prev,firstName:profile.firstName||user.firstName||'',lastName:profile.lastName||user.lastName||'',email:profile.email||((_user$primaryEmailAdd=user.primaryEmailAddress)===null||_user$primaryEmailAdd===void 0?void 0:_user$primaryEmailAdd.emailAddress)||'',phone:profile.phone||'',dateOfBirth:profile.dateOfBirth||'',gender:profile.gender||'',communicationsAccepted:profile.communicationsAccepted||false,termsAccepted:false// Always start unchecked\n};});}else if(user&&type==='solo'){// Fallback to Clerk data if no profile exists\nsetSolo(prev=>{var _user$primaryEmailAdd2;return{...prev,firstName:user.firstName||'',lastName:user.lastName||'',email:((_user$primaryEmailAdd2=user.primaryEmailAddress)===null||_user$primaryEmailAdd2===void 0?void 0:_user$primaryEmailAdd2.emailAddress)||''};});}// Pre-fill first player in group with user profile data\nif(profile&&type==='group'){var _user$primaryEmailAdd3;const updatedGroup=[...group];updatedGroup[0]={firstName:profile.firstName||user.firstName||'',lastName:profile.lastName||user.lastName||'',email:profile.email||((_user$primaryEmailAdd3=user.primaryEmailAddress)===null||_user$primaryEmailAdd3===void 0?void 0:_user$primaryEmailAdd3.emailAddress)||''};setGroup(updatedGroup);}else if(user&&type==='group'){var _user$primaryEmailAdd4;// Fallback to Clerk data if no profile exists\nconst updatedGroup=[...group];updatedGroup[0]={firstName:user.firstName||'',lastName:user.lastName||'',email:((_user$primaryEmailAdd4=user.primaryEmailAddress)===null||_user$primaryEmailAdd4===void 0?void 0:_user$primaryEmailAdd4.emailAddress)||''};setGroup(updatedGroup);}}catch(err){console.error('Failed to load registration data:',err);setError('Failed to load leagues. Please try again.');}finally{setIsLoading(false);}};loadData();}},[isOpen,user,type]);if(!isOpen)return null;const handleInput=(e,idx)=>{const{name,value,type}=e.target;const checked=e.target.checked;setFieldErrors({});if(typeof idx==='number'){const updated=[...group];updated[idx]={...updated[idx],[name]:type==='checkbox'?checked:value};setGroup(updated);}else{setSolo(prev=>({...prev,[name]:type==='checkbox'?checked:value}));}};const handleAddPlayer=()=>{if(group.length<MAX_GROUP_SIZE){setGroup([...group,{firstName:'',lastName:'',email:''}]);}};const handleRemovePlayer=idx=>{if(group.length>MIN_GROUP_SIZE){setGroup(group.filter((_,i)=>i!==idx));}};const validateSolo=()=>{const errors={};if(!selectedLeague)errors.league='Please select a league.';if(!solo.firstName)errors.firstName='First name is required.';if(!solo.lastName)errors.lastName='Last name is required.';const emailError=getEmailError(solo.email);if(emailError)errors.email=emailError;const phoneError=getPhoneError(solo.phone);if(phoneError)errors.phone=phoneError;if(!solo.dateOfBirth)errors.dateOfBirth='Date of birth is required.';if(!solo.gender)errors.gender='Gender is required.';if(!solo.termsAccepted)errors.termsAccepted='You must accept the terms of service.';return errors;};const validateGroup=()=>{const errors={};if(!selectedLeague)errors.league='Please select a league.';if(!groupName)errors.groupName='Group name is required.';if(group.length<MIN_GROUP_SIZE)errors.group='A group must have at least 2 players.';group.forEach((player,idx)=>{if(!player.firstName)errors[`player${idx}_firstName`]='First name required.';if(!player.lastName)errors[`player${idx}_lastName`]='Last name required.';const emailError=getEmailError(player.email);if(emailError)errors[`player${idx}_email`]=emailError;});return errors;};const handleSubmit=async e=>{e.preventDefault();setError('');setSuccess('');setFieldErrors({});if(type==='solo'){const errors=validateSolo();if(Object.keys(errors).length>0){setFieldErrors(errors);setError('Please fix the errors above.');return;}try{// Create user profile from registration data\nconst userProfile={firstName:solo.firstName,lastName:solo.lastName,email:solo.email,phone:solo.phone,dateOfBirth:solo.dateOfBirth,gender:solo.gender,communicationsAccepted:solo.communicationsAccepted,registrationStatus:'registered',// Mark as registered\nteamId:undefined,// Will be assigned when teams are created\ngroupName:undefined,registrationDate:new Date().toISOString().split('T')[0],// Today's date\npaymentStatus:'pending',// Will be updated when payment is processed\nwaiverStatus:'pending',// Will be updated when waiver is signed\nleagueId:selectedLeague||undefined// Store the selected league ID\n};// Save to user profile\nif(user){await apiService.updateUserProfile(user.id,userProfile);const selectedLeagueData=leagues.find(l=>l.id===selectedLeague);const leagueName=selectedLeagueData?selectedLeagueData.name:'the league';setSuccess(`League registration submitted successfully! Welcome to ${leagueName}! Your profile has been updated.`);// Notify parent that registration is complete\nif(onRegistrationComplete){onRegistrationComplete();}// Close modal after a short delay\nsetTimeout(()=>{onClose();},2000);}else{setError('User not found. Please try signing in again.');}}catch(err){console.error('Failed to save registration:',err);setError('Failed to save registration. Please try again.');}}else{const errors=validateGroup();if(Object.keys(errors).length>0){setFieldErrors(errors);setError('Please fix the errors above.');return;}setSuccess(`Group registration submitted! Invitations will be sent to ${group.length} players. Your group will be kept together during team formation.`);// TODO: Send to backend - this will trigger email invitations and mark as a group\n}};// Check if form is valid for submit button\nconst isFormValid=()=>{if(type==='solo'){return selectedLeague&&solo.firstName&&solo.lastName&&!getEmailError(solo.email)&&!getPhoneError(solo.phone)&&solo.phone&&solo.dateOfBirth&&solo.gender&&solo.termsAccepted;}else{if(!selectedLeague||!groupName||group.length<MIN_GROUP_SIZE)return false;return group.every(player=>player.firstName&&player.lastName&&!getEmailError(player.email));}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gunmetal border-2 border-pumpkin rounded-xl shadow-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto relative\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"absolute top-2 right-2 text-pumpkin hover:text-deeporange text-2xl font-bold\",onClick:onClose,\"aria-label\":\"Close registration modal\",children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-pumpkin mb-4 text-center\",children:\"Register for League\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center mb-4 gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:`px-4 py-2 rounded font-bold border-2 ${type==='solo'?'bg-pumpkin text-black border-pumpkin':'bg-black text-pumpkin border-pumpkin'} transition-colors`,onClick:()=>{setType('solo');setError('');setSuccess('');setFieldErrors({});},children:\"Solo\"}),/*#__PURE__*/_jsx(\"button\",{className:`px-4 py-2 rounded font-bold border-2 ${type==='group'?'bg-pumpkin text-black border-pumpkin':'bg-black text-pumpkin border-pumpkin'} transition-colors`,onClick:()=>{setType('group');setError('');setSuccess('');setGroup(getInitialGroup());setFieldErrors({});},children:\"Group\"})]}),isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-black bg-opacity-50 rounded-lg\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-300 text-center\",children:\"Loading leagues...\"})}):leagues.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-3 bg-black bg-opacity-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-pumpkin mb-2\",children:\"Select League:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedLeague||'',onChange:e=>setSelectedLeague(Number(e.target.value)),className:`w-full p-2 rounded bg-black border text-white focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.league?'border-red-500':'border-pumpkin'}`,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a league...\"}),leagues.map(league=>/*#__PURE__*/_jsxs(\"option\",{value:league.id,children:[league.name,\" - \",league.description]},league.id))]}),fieldErrors.league&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mt-1\",children:fieldErrors.league})]}):/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-red-900 bg-opacity-50 rounded-lg\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-300 text-center\",children:\"No active leagues available at this time.\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-black bg-opacity-50 rounded-lg\",children:type==='solo'?/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-300\",children:userProfile?'Your profile information has been pre-filled. Review and complete any missing fields to register for the league.':'Register as an individual player for the league.'}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-300 space-y-2\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Group Registration:\"}),\" Register with friends to ensure you stay together during team formation.\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Groups of 2-7 players\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 All members must accept invitations\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 System will try to keep your group together\"})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[type==='solo'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.firstName?'border-red-500':''}`,name:\"firstName\",placeholder:\"First Name\",value:solo.firstName,onChange:handleInput,autoComplete:\"given-name\",readOnly:!!(user!==null&&user!==void 0&&user.firstName)}),/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.lastName?'border-red-500':''}`,name:\"lastName\",placeholder:\"Last Name\",value:solo.lastName,onChange:handleInput,autoComplete:\"family-name\",readOnly:!!(user!==null&&user!==void 0&&user.lastName)})]}),typeof fieldErrors.firstName==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors.firstName}),typeof fieldErrors.lastName==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors.lastName}),/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.email?'border-red-500':''}`,name:\"email\",placeholder:\"Email\",value:solo.email,onChange:handleInput,autoComplete:\"email\",type:\"email\",readOnly:!!(user!==null&&user!==void 0&&(_user$primaryEmailAdd5=user.primaryEmailAddress)!==null&&_user$primaryEmailAdd5!==void 0&&_user$primaryEmailAdd5.emailAddress)}),(()=>{const error=fieldErrors.email;if(!error)return null;if(typeof error==='object'&&typeof error.suggestion==='string'){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-400 text-xs mb-1\",children:[error.message,' ',/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"underline text-pumpkin hover:text-deeporange\",onClick:()=>setSolo(prev=>({...prev,email:error.suggestion||prev.email})),children:\"Yes\"})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:error});})(),/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.phone?'border-red-500':''}`,name:\"phone\",placeholder:\"Phone\",value:solo.phone,onChange:handleInput,autoComplete:\"tel\",type:\"tel\"}),typeof fieldErrors.phone==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors.phone}),/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.dateOfBirth?'border-red-500':''}`,name:\"dateOfBirth\",placeholder:\"Date of Birth\",value:solo.dateOfBirth,onChange:handleInput,autoComplete:\"bday\",type:\"date\"}),typeof fieldErrors.dateOfBirth==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors.dateOfBirth}),/*#__PURE__*/_jsxs(\"select\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.gender?'border-red-500':''}`,name:\"gender\",value:solo.gender,onChange:handleInput,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Gender\"}),/*#__PURE__*/_jsx(\"option\",{value:\"male\",children:\"Male\"}),/*#__PURE__*/_jsx(\"option\",{value:\"female\",children:\"Female\"}),/*#__PURE__*/_jsx(\"option\",{value:\"other\",children:\"Other\"}),/*#__PURE__*/_jsx(\"option\",{value:\"prefer-not-to-say\",children:\"Prefer not to say\"})]}),typeof fieldErrors.gender==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors.gender}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 pt-2\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-start gap-3 cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"termsAccepted\",checked:solo.termsAccepted,onChange:handleInput,className:\"mt-1 w-4 h-4 text-pumpkin bg-black border-pumpkin rounded focus:ring-pumpkin focus:ring-2\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-300\",children:[\"I agree to the \",/*#__PURE__*/_jsx(\"a\",{href:\"/terms\",className:\"text-pumpkin hover:text-deeporange underline\",children:\"Terms of Service\"}),\" and acknowledge that by registering, I am bound by these terms.\"]})]}),typeof fieldErrors.termsAccepted==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs\",children:fieldErrors.termsAccepted}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-start gap-3 cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"communicationsAccepted\",checked:solo.communicationsAccepted,onChange:handleInput,className:\"mt-1 w-4 h-4 text-pumpkin bg-black border-pumpkin rounded focus:ring-pumpkin focus:ring-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-300\",children:\"I consent to receive communications about league activities, schedules, and updates via email.\"})]})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors.groupName?'border-red-500':''}`,name:\"groupName\",placeholder:\"Group Name (e.g., 'The Friends', 'Work Buddies')\",value:groupName,onChange:e=>setGroupName(e.target.value),autoComplete:\"off\"}),typeof fieldErrors.groupName==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors.groupName}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-300 mb-4 p-3 bg-black bg-opacity-30 rounded\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCE7 \",/*#__PURE__*/_jsx(\"strong\",{children:\"Group Invite System:\"}),\" Enter your friends' information below. Each person will receive an email invitation to join your group.\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-2 text-xs\",children:[\"\\uD83D\\uDCA1 \",/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" Your group will be kept together during team formation, but may be combined with other players to form complete teams.\"]})]}),group.map((player,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-2 mb-4 p-3 bg-black bg-opacity-30 rounded\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-pumpkin font-semibold\",children:[\"Group Member \",idx+1]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors[`player${idx}_firstName`]?'border-red-500':''}`,name:\"firstName\",placeholder:\"First Name\",value:player.firstName,onChange:e=>handleInput(e,idx),autoComplete:\"off\"}),/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors[`player${idx}_lastName`]?'border-red-500':''}`,name:\"lastName\",placeholder:\"Last Name\",value:player.lastName,onChange:e=>handleInput(e,idx),autoComplete:\"off\"})]}),typeof fieldErrors[`player${idx}_firstName`]==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors[`player${idx}_firstName`]}),typeof fieldErrors[`player${idx}_lastName`]==='string'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:fieldErrors[`player${idx}_lastName`]}),/*#__PURE__*/_jsx(\"input\",{className:`w-full p-2 rounded bg-black border border-pumpkin text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pumpkin ${fieldErrors[`player${idx}_email`]?'border-red-500':''}`,name:\"email\",placeholder:\"Email Address\",value:player.email,onChange:e=>handleInput(e,idx),autoComplete:\"off\",type:\"email\"}),(()=>{const error=fieldErrors[`player${idx}_email`];if(!error)return null;if(typeof error==='object'&&typeof error.suggestion==='string'){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-400 text-xs mb-1\",children:[error.message,' ',/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"underline text-pumpkin hover:text-deeporange\",onClick:()=>{const updated=[...group];updated[idx].email=error.suggestion;setGroup(updated);},children:\"Yes\"})]});}if(typeof error==='string'){return/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-xs mb-1\",children:error});}return null;})()]},idx)),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleAddPlayer,className:\"w-full p-2 rounded bg-pumpkin text-black font-bold hover:bg-deeporange transition-colors\",disabled:group.length>=MAX_GROUP_SIZE,children:\"Add Player\"}),group.length>MIN_GROUP_SIZE&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleRemovePlayer(group.length-1),className:\"w-full p-2 rounded bg-red-500 text-white font-bold hover:bg-red-600 transition-colors\",children:\"Remove Last Player\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-400 text-center\",children:error}),success&&/*#__PURE__*/_jsx(\"div\",{className:\"text-green-400 text-center\",children:success}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full p-2 rounded bg-pumpkin text-black font-bold hover:bg-deeporange transition-colors\",disabled:!isFormValid(),children:type==='solo'?'Register Solo':'Register Group'})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}